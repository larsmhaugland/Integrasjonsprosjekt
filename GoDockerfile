FROM golang:alpine as builder

#Copy project to container
COPY Go/go.mod /GoApp/go.mod
COPY Go/go.sum /GoApp/go.sum

#Set working directory
WORKDIR /GoApp

RUN go mod download

COPY Go /GoApp
#Build the Go app
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -o /GoApp/main .

#Build a small image with the binary and HTTPS certificates
FROM scratch
COPY --from=builder /GoApp/main /GoApp/main
COPY Go/HTTPS/ /GoApp/HTTPS/

WORKDIR /GoApp

#Expose port 8080
EXPOSE 8080

ENTRYPOINT ["/GoApp/main"]