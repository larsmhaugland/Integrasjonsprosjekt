LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule php7_module modules/libphp7.4.so

Listen 80

<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "/usr/local/apache2/htdocs/"

    # Set environment variable API_URL for Apache (only once)
    SetEnv API_URL https://10.212.174.249:8080

    # Pass environment variables to PHP scripts
    SetEnvIf Request_URI "\.php$" PHP_API_URL=$API_URL
    PassEnv PHP_API_URL

    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
        SetEnv API_URL "${PHP_API_URL}"
    </FilesMatch>

    <Directory "/usr/local/apache2/htdocs/">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

Listen 443

<VirtualHost *:443>
    SSLEngine on
    SSLCertificateFile "/HTTPS/server.crt"
    SSLCertificateKeyFile "/HTTPS/server.key"
    DocumentRoot "/usr/local/apache2/htdocs/"

    # No need to set the environment variable again here

    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
        SetEnv API_URL "${PHP_API_URL}"
    </FilesMatch>

    <Directory "/usr/local/apache2/htdocs/">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
