FROM php:7.4-apache
MAINTAINER noen

#Remove default apache website
RUN rm -rf /usr/local/apache2/htdocs/*

#Copy website to apache root
COPY Webserver /usr/local/apache2/htdocs/

RUN mv /usr/local/apache2/htdocs/HTTPS /

#Copy custom apache config
RUN mv /usr/local/apache2/htdocs/custom_apache.conf /usr/local/apache2/conf/httpd.conf
RUN echo "date.timezone = 'Europe/Oslo'" > /usr/local/etc/php/conf.d/timezone.ini
RUN a2enmod rewrite

RUN echo "memory_limit = 256M" > /usr/local/etc/php/conf.d/memory-limit.ini && \
    echo "post_max_size = 100M" > /usr/local/etc/php/conf.d/post-max-size.ini && \
    echo "upload_max_filesize = 100M" > /usr/local/etc/php/conf.d/upload-max-size.ini && \
    echo "file_uploads = On" > /usr/local/etc/php/conf.d/file-uploads.ini


#Expose ports
EXPOSE 80
EXPOSE 443

#Run apache in foreground
CMD ["apachectl", "-D", "FOREGROUND"]
